{% extends "_layout.njk" %}

{% set headerNavId = "account" %}

{% set title = "Your email notifications" %}
{#% set caption = user.firstName + " " + user.lastName %#}

{% block beforeContent %}
{{ govukBreadcrumbs({
  items: [{
    text: "Your account",
    href: "/account"
  }, {
    text: title
  }]
}) }}
{% endblock %}

{% block content %}

  {% include "_includes/notification-banner.njk" %}

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">

      <h1 class="govuk-heading-l">
        {% if caption.length %}
          <span class="govuk-caption-l">
            {{ caption }}
          </span>
        {% endif %}
        {{ title }}
      </h1>

      {% for organisation in user.organisations %}

        {% if user.organisations.length > 1 %}
          <h2 class="govuk-heading-m {{- ' govuk-!-margin-top-9' if loop.index > 1 }}">{{ organisation.name }}</h2>
        {% endif %}

        <p class="govuk-body">
          <a class="govuk-link" href="/account/notifications/organisations/{{ organisation.id }}/edit">
            Change email notifications<span class="govuk-visually-hidden"> for {{ organisation.name }}</span>
          </a>
        </p>

        {% if organisation.type in ["hei","scitt"] %}

          {% if user.organisations.length > 1 %}
            <h3 class="govuk-heading-s">Courses run by my organisation</h3>
          {% else %}
            <h2 class="govuk-heading-m">Courses run by my organisation</h2>
          {% endif %}

        {% endif %}

        <dl class="govuk-summary-list">
          {% for notification in notificationOptions %}
            {% if notification.providerTypes.length == 3 and organisation.type in notification.providerTypes %}
              <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key govuk-!-width-one-half">
                  {{ notification.name }}
                </dt>
                <dd class="govuk-summary-list__value">
                  {{ "On" if (organisation.notifications and notification.code in organisation.notifications) else "Off" }}
                </dd>
              </div>
            {% endif %}
          {% endfor %}
        </dl>

        {% if organisation.type in ["hei","scitt"] %}

          {% if user.organisations.length > 1 %}
            <h3 class="govuk-heading-s">Courses run by partner organisations</h3>
          {% else %}
            <h2 class="govuk-heading-m">Courses run by partner organisations</h2>
          {% endif %}

          <dl class="govuk-summary-list">
            {% for notification in notificationOptions %}
              {% if notification.providerTypes.length == 2 and organisation.type in notification.providerTypes %}
                <div class="govuk-summary-list__row">
                  <dt class="govuk-summary-list__key govuk-!-width-one-half">
                    {{ notification.name }}
                  </dt>
                  <dd class="govuk-summary-list__value">
                    {{ "On" if (organisation.notifications and notification.code in organisation.notifications) else "Off" }}
                  </dd>
                </div>
              {% endif %}
            {% endfor %}
          </dl>
        {% endif %}


      {% endfor %}

    </div>
  </div>

{% endblock %}
